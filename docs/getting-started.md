# Prerequisites

- [We highly recommend using VOLTA to manage your JavaScript command-line tools like Node.jsÂ® and Yarn](volta.sh)

## Visual Studio Code - recommended extensions

Extensions are stored in `.vscode/extenstions.json`, and will automatically be suggested to be installed when launching the project from Visual Studio Code.

## DataHub Application (app-dh)

Deployed version of the application can be found [here.](https://cdn-dh-endpoint-dh-u-001.azureedge.net/)  
Currently the application is only deployed to a single environment.

### Running the application

To run the application locally you need to serve the frontend application and corrosponding BFF (Backend for frontend).

### Frontend application

`yarn nx serve app-dh`

### BFF (backend for frontend)

Before you're able to run the BFF locally you need to copy `build/ci/dh/api-dh/ci.appsettings.Development.json` -> `apps/dh/api-dh/source/DataHub.WebApi/appsettings.Development.json`. If you're using powershell core or another terminal with `cp` you can do it with:  
`yarn nx run api-dh:ci-configuration`  
Otherwise you need to do the copying manually. This should be done everytime a new client is added.

To run the BFF locally:

`yarn nx serve api-dh`

### Unit / Integration Testing

Currently the test suites are integrating with the BFF (backend for frontend), so to run the tests succesfully make sure you're already serving the backend locally.

`yarn test`

While developing you can run the tests in watch mode:

`yarn test --watch`

### E2E Testing

Due to the limitations of Cypress authenticating against MSAL (B2C), we have chosen to use playwright for our E2E tests. To be able to running the tests locally, you will need to rename `apps\dh\e2e-dh\.env` to `apps\dh\e2e-dh\.env.local` and insert some testing user credentials.

To run the tests use following command:

`yarn nx run e2e-dh:e2e`

To debug E2E tests with the playwright inspector you can use following command (Windows PowerShell), you can find more information [here](https://playwright.dev/docs/debug):

`$Env:PWDEBUG=1; npx playwright test apps/dh/e2e-dh/src --config=apps/dh/e2e-dh/playwright.ts --workers=1`

### Generating new components

New components can be generated by the command-line or through the Nx Console extension from Visual Studio Code.

`yarn nx generate @schematics/angular:component --name=<my-new-awesome-component> --project=<library-name> --prefix=dh --skipImport`

### Generating new libraries

New libraries can be generated by the command-line or through the Nx Console extension from Visual Studio Code.

`nx generate @nrwl/angular:library --name=<libary type>-my-awesome-library --directory=dh/<domain> --importPath=@energinet-datahub/dh/metering-point/my-awesome-lib --prefix=dh --skipPackageJson --standaloneConfig --tags=product:dh,domain:<domain>,type:<library type>`

## Design System

The design system is deployed through chromatic, and can be found here:  
[Latest version (main)](https://main--61765fc47451ff003afe62ff.chromatic.com/)

You can also find a deployed version of your specific branch here (direct link, can also be found under checks in a pull-request):  
`https://<branch>--61765fc47451ff003afe62ff.chromatic.com`

### Running it locally

`yarn designsystem:start`

## Architecture

The repository is a mono-repo which hosts serveral applications.  
This means that dependencies are shared by every application inside this repository.  
`Example: every application is running the same version of Angular.`

The repository is setup using [Nx from NRWL](https://nx.dev/l/a/getting-started/intro) which means that you shouldn't use the `Angular CLI` directly.

### Dependency graph / Project Graph

You can generate a dependency graph by running following command, to get an overview of the applications in the mono-repo:

`yarn dep-graph`
